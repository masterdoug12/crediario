import{a as p,r as k,i as S,j as U,c as r,b as e,d as c,e as v,v as y,n as E,t as i,F as O,k as L,w as M,f as R,g,u as z,o as d,l as I}from"./index-BzPhx2A_.js";const q={class:"d-flex flex-column gap-4"},A={class:"card border-0 card-shadow"},G={class:"card-body"},P={class:"row g-2 mb-4 align-items-center"},H={class:"col-md-6"},J={class:"table-responsive"},K={class:"table align-middle"},Q={key:0},W={key:1},X={class:"fw-semibold"},Y={class:"text-end"},Z={class:"btn-group btn-group-sm",role:"group"},ee=["onClick"],te=["onClick"],se=["onClick"],oe={key:0,class:"modal fade show d-block",tabindex:"-1",role:"dialog","aria-modal":"true"},le={class:"modal-dialog modal-dialog-centered"},ne={class:"modal-content"},ae={class:"modal-header"},re={class:"modal-title h5 mb-0"},de={class:"modal-body vstack gap-3"},ie={key:0,class:"text-danger small mt-1"},ce={key:0,class:"text-danger small mt-1"},ue={key:0,class:"text-danger small mt-1"},me={class:"modal-footer"},pe=["disabled"],fe={key:0,class:"spinner-border spinner-border-sm me-2",role:"status"},ye={__name:"ClientesListView",setup(be){const N=z(),h=p([]),_=p(!1),u=p(""),l=k({type:"",message:""}),o=k({id:null,nome:"",telefone:"",endereco:""}),a=k({}),m=p(!1),f=p(!1),T=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"});let x;const b=async(s="")=>{_.value=!0;try{const{data:t}=await g.get("/clientes",{params:s?{q:s}:{}});h.value=t}catch(t){l.type="danger",l.message=t.response?.data?.mensagem??"Não foi possível carregar os clientes."}finally{_.value=!1}},F=()=>{clearTimeout(x),x=setTimeout(()=>{b(u.value.trim())},400)},V=()=>{o.id=null,o.nome="",o.telefone="",o.endereco="",Object.keys(a).forEach(s=>delete a[s]),m.value=!0},j=s=>{o.id=s.id,o.nome=s.nome,o.telefone=s.telefone??"",o.endereco=s.endereco??"",Object.keys(a).forEach(t=>delete a[t]),m.value=!0},C=()=>{m.value=!1},$=async()=>{f.value=!0,Object.keys(a).forEach(s=>delete a[s]),l.type="",l.message="";try{const s={nome:o.nome,telefone:o.telefone||null,endereco:o.endereco||null};o.id?(await g.put(`/clientes/${o.id}`,s),l.type="success",l.message="Cliente atualizado com sucesso!"):(await g.post("/clientes",s),l.type="success",l.message="Cliente cadastrado com sucesso!"),await b(u.value.trim()),m.value=!1}catch(s){s.response?.status===422&&s.response.data.errors?Object.assign(a,s.response.data.errors):(l.type="danger",l.message=s.response?.data?.mensagem??"Erro ao salvar cliente. Tente novamente.")}finally{f.value=!1}},B=async s=>{if(confirm(`Deseja realmente excluir o cliente ${s.nome}?`))try{await g.delete(`/clientes/${s.id}`),l.type="success",l.message="Cliente removido com sucesso.",await b(u.value.trim())}catch(t){l.type="danger",l.message=t.response?.data?.mensagem??"Não foi possível excluir o cliente."}},D=s=>{N.push({name:"cliente-detalhes",params:{id:s.id}})};return S(()=>{b()}),U(()=>{clearTimeout(x)}),(s,t)=>(d(),r("div",q,[e("div",{class:"d-flex flex-column flex-lg-row align-items-lg-center justify-content-between gap-3"},[t[4]||(t[4]=e("div",null,[e("h1",{class:"h3 mb-1"},"Clientes"),e("p",{class:"text-muted mb-0"},"Gerencie os crediários e acompanhe os saldos em tempo real.")],-1)),e("div",null,[e("button",{class:"btn btn-primary",type:"button",onClick:V}," Novo cliente ")])]),e("div",A,[e("div",G,[e("div",P,[e("div",H,[t[5]||(t[5]=e("label",{class:"form-label text-muted-sm",for:"busca"},"Buscar por nome ou telefone",-1)),v(e("input",{id:"busca","onUpdate:modelValue":t[0]||(t[0]=n=>u.value=n),class:"form-control",type:"search",placeholder:"Digite para filtrar",onInput:F},null,544),[[y,u.value]])])]),l.message?(d(),r("div",{key:0,class:E(`alert alert-${l.type}`),role:"alert"},i(l.message),3)):c("",!0),e("div",J,[e("table",K,[t[8]||(t[8]=e("thead",null,[e("tr",null,[e("th",null,"Cliente"),e("th",null,"Telefone"),e("th",null,"Endereço"),e("th",{class:"text-end"},"Saldo atual"),e("th",{class:"text-end"},"Ações")])],-1)),e("tbody",null,[_.value?(d(),r("tr",Q,[...t[6]||(t[6]=[e("td",{colspan:"5",class:"text-center py-4"},[e("div",{class:"spinner-border text-primary",role:"status"},[e("span",{class:"visually-hidden"},"Carregando...")])],-1)])])):h.value.length===0?(d(),r("tr",W,[...t[7]||(t[7]=[e("td",{colspan:"5",class:"text-center py-4 text-muted"},"Nenhum cliente encontrado.",-1)])])):c("",!0),(d(!0),r(O,null,L(h.value,n=>(d(),r("tr",{key:n.id},[e("td",X,i(n.nome),1),e("td",null,i(n.telefone??"—"),1),e("td",null,i(n.endereco??"—"),1),e("td",{class:E(["text-end fw-semibold",n.saldo_atual>0?"text-danger":"text-success"])},i(I(T).format(n.saldo_atual)),3),e("td",Y,[e("div",Z,[e("button",{class:"btn btn-outline-secondary",type:"button",onClick:w=>D(n)}," Detalhes ",8,ee),e("button",{class:"btn btn-outline-secondary",type:"button",onClick:w=>j(n)}," Editar ",8,te),e("button",{class:"btn btn-outline-danger",type:"button",onClick:w=>B(n)}," Excluir ",8,se)])])]))),128))])])])])]),m.value?(d(),r("div",oe,[e("div",le,[e("div",ne,[e("div",ae,[e("h2",re,i(o.id?"Editar cliente":"Novo cliente"),1),e("button",{type:"button",class:"btn-close","aria-label":"Fechar",onClick:C})]),e("form",{onSubmit:M($,["prevent"])},[e("div",de,[e("div",null,[t[9]||(t[9]=e("label",{class:"form-label",for:"nome"},"Nome completo",-1)),v(e("input",{id:"nome","onUpdate:modelValue":t[1]||(t[1]=n=>o.nome=n),class:"form-control",type:"text",required:""},null,512),[[y,o.nome]]),a.nome?(d(),r("div",ie,i(a.nome[0]),1)):c("",!0)]),e("div",null,[t[10]||(t[10]=e("label",{class:"form-label",for:"telefone"},"Telefone",-1)),v(e("input",{id:"telefone","onUpdate:modelValue":t[2]||(t[2]=n=>o.telefone=n),class:"form-control",type:"text"},null,512),[[y,o.telefone]]),a.telefone?(d(),r("div",ce,i(a.telefone[0]),1)):c("",!0)]),e("div",null,[t[11]||(t[11]=e("label",{class:"form-label",for:"endereco"},"Endereço",-1)),v(e("input",{id:"endereco","onUpdate:modelValue":t[3]||(t[3]=n=>o.endereco=n),class:"form-control",type:"text"},null,512),[[y,o.endereco]]),a.endereco?(d(),r("div",ue,i(a.endereco[0]),1)):c("",!0)])]),e("div",me,[e("button",{type:"button",class:"btn btn-secondary",onClick:C},"Cancelar"),e("button",{class:"btn btn-primary",type:"submit",disabled:f.value},[f.value?(d(),r("span",fe)):c("",!0),t[12]||(t[12]=R(" Salvar ",-1))],8,pe)])],32)])])])):c("",!0)]))}};export{ye as default};
